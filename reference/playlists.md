# Playlists

## File format

Playlists are plain text files with a `.playlist` extension, stored in `playlists/` (overridable via `PLAYLISTS_DIR` env var). Each line is a song filename matching an entry in `songs/`:

```
Jamie Paige - Birdbrain.mp3
Jamie Paige - Breeze Blows.mp3
Jamie Paige - Cadmium Colors.mp3
```

Lines that don't match any loaded song are silently skipped. Blank lines are ignored.

## Loading

`scan_playlists()` runs at startup after `scan_songs()`. It uses `scandir()` + `alphasort` on the playlists directory, stores each name (without the `.playlist` extension) in `playlists[]`. Missing directory is fine — `nplaylists` stays 0.

`load_playlist(idx)` reads the file line-by-line, matches each line against `songs[]` via `strcmp`, and populates `playlist_songs[]` with the corresponding indices.

## Sidebar

Ctrl+M toggles a right-side sidebar (24 columns wide with a `|` border). The CSI sequence `\033[109;5u` is generated by st for Ctrl+M — detected by reading the initial `\033` byte then polling for more bytes (20ms timeout).

Layout:

```
Main content                                               |Playlists
-----------------------------------------------------------|------------------------
> song-a.mp3                                               |  [All Songs]
  song-b.mp3                                               |> my-playlist
```

### Navigation (when sidebar is open)

| Key     | Action                                                  |
|---------|---------------------------------------------------------|
| j / k   | move cursor up/down                                     |
| g / G   | jump to top/bottom                                      |
| Enter   | select playlist (or [All Songs] to clear), close sidebar |
| Escape  | close sidebar without changing active playlist          |
| Ctrl+M  | close sidebar                                           |

When the sidebar opens, the cursor is placed on the currently active playlist.

## Display list integration

`song_at()` and `display_len()` have three layers:

1. **Filter active** → uses `filtered[]` / `nfiltered`
2. **Playlist active** → uses `playlist_songs[]` / `nplaylist_songs`
3. **Default** → uses `songs[]` / `nsongs`

`apply_filter()` iterates over `playlist_songs[]` (when active) instead of `songs[]`, so search with `/` operates within the playlist.

Selecting a playlist clears any active search/filter and resets the cursor.

## Header

When a playlist is active, the header shows the name: `MusicPlayer [jamie-paige] | [||||||||||||||||||||]`. Cleared when [All Songs] is selected.
